# Quaternion (쿼터니언)

# 정의

공간에서 한 오브젝트의 방향(회전)을 묘사하는 표기법이다.

$$⁍$$

이러한 관계가 성립할 때

$$q = w + xi + yj + zk$$

또는

$$q = (w, x, y, z)$$

로 나타낸다.

$v = (x, y, z)$를 하나로 몰아 이렇게 쓰기도 한다.

$$q = (w, v)$$

# 계산

## 곱셈

$$q1⋅q2=(w1w2−(v1⋅v2),w1v2+w2v1+(v1×v2))$$

## 켤레 (Conjugate)

복소수와 비슷하게 허수부의 부호만 바꿔준다

$$q=(w,v)$$

$$q∗=(w,−v)$$

이때 다음과 같은 성질들을 만족한다.

$$(q∗)∗=q$$

$$(pq)∗=q∗p∗$$

$$qq∗=q∗q$$

## 크기

$$∥q∥=√qq∗=√q∗q=√w2+x2+y2+z2
$$

## 항등원

$$I=(1,0,0,0)$$

## 역원

$$q^-1=q∗/∥q∥2$$

# 회전

## 회전 복소수

$$(1,θ)→(cosθ,sinθ)→cosθ+sinθ⋅i$$

## 회전 사원수

복소수가 2차원 회전변환을 나타낼 수 있는것처럼, 사원수를 이용해서 4차원 회전변환을 나타낼 수 있다. 이들은 실수부(w)값이 0이고, 허수부가 단위 벡터 v_hat으로 이루어져있다. 이렇게 크기가 1인 사원수를 단위 벡터처럼 단위 사원수라고 하며 r_hat로 나타낸다.

$$\hat{q} \cdot p_q \cdot \hat{q}^{-1}$$

위의 식은 P_smallQ를 v_hat을 기준으로 2θ만큼 회전시킨다.

$$p′=(0,p+2w(v×p)+2(v×(v×p)))$$

풀어서 정리하면 위와 같다.

## 회전행렬로의 변화

오일러 공식을 정리하면

$$M_q = \begin{bmatrix}
1 -2y^2 - 2z^2 & 2xy-2wz & 2xz + 2wy & 0 \\
2xy + 2wz & 1 - 2x^2 -2z^2 & 2yz - 2wx & 0 \\
2xz - 2wy & 2yz + 2wx & 1 -2x^2-2y^2 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}$$

위와 같다고 한다.

# 쿼터니언의 장점과 단점

- 오일러 각 시스템

```
- 3차원상의 강체와 방향과 회전을 정의하기 위해 만들어낸 시스템
- 3차원 공간의 절대 좌표를 기준으로 물체의 회전을 측정하는 방식
- x, y, z 세 축을 기준으로 회전을 표기
- (x, y, z)로 표기
- 회전 순서에 따라 짐벌락이 일어날 수 있음
```

- 짐벌락

```
세 축이 의존적으로 회전하면서 두 축의 회전이 겹치는 경우 
한 축에 대한 자유도를 상실하게 되는 경우
짐벌락을 막기 위해 오일러 각의 범위는 α와 γ의 경우 
이상적인 상황에서 2π 라디안까지이며, β의 경우 -π/2에서 π/2
```

- 쿼터니안

```c
4개의 수 x, y, z, w로 이루어지며 하나의 벡터(x, y, z) 와 w로 이루어진다.
세 축을 동시에 회전시키기 때문에 짐벌 락이 발생하지 않는다.
벡터가 위치임과 동시에 방향이듯 쿼터니엄은 방향과 동시에 회전이다.
```

## 장점

- 짐벌락 문제 해결
- 계산하는데 드는 비용이 적다.

## 한계

- 회전이 하나의 방향에서 다른방향으로 측정되기에 180도 이상의 회전을 할 수 없다.
- 직관적으로 이해하기 힘들다.

# 참고 사이트들

[[유니티 기초] - Quaternion](https://blog.naver.com/PostView.nhn?blogId=dj3630&logNo=221447943453)

[쿼터니온(Quaternion) 정리](https://enghqii.tistory.com/63)

[쿼터니언 이해하기](http://chanhaeng.blogspot.com/2018/07/blog-post.html)